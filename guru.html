<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <title>Sistem Kehadiran - Paparan Guru</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #f4f4f4; }
    .belum { background-color: #e0f7e9; }   /* hijau lembut */
    .dipanggil { background-color: #f9d6d5; color: #666; } /* merah pudar */
    button { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
    button.panggil { background: #ff5252; color: white; }
    button:disabled { background: #aaa; cursor: not-allowed; }
    tr.fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <h2>ðŸ“‹ Senarai Kehadiran Ibu Bapa</h2>
  <table id="senarai">
    <thead>
      <tr>
        <th>No Giliran</th>
        <th>Nama Anak</th>
        <th>Masa Daftar</th>
        <th>Status</th>
        <th>Tindakan</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwVB4CtJ9OYpppnvcMDpZ_-f3dMm8SH--UN7bEQja_CVfX563LGM4x8H56fzSV4lXlU/exec"; // letak URL Google Script anda

    async function loadSenarai() {
      try {
        let res = await fetch(API_URL + "?action=senarai");
        let data = await res.json();

        let tbody = document.querySelector("#senarai tbody");
        tbody.innerHTML = "";

        data.forEach(item => {
          let tr = document.createElement("tr");
          tr.classList.add("fade-in");

          // status warna
          tr.classList.add(item.status === "Belum Dipanggil" ? "belum" : "dipanggil");

          tr.innerHTML = `
            <td>${item.no}</td>
            <td>${item.nama}</td>
            <td>${new Date(item.masa).toLocaleString()}</td>
            <td>${item.status}</td>
            <td>
              <button class="panggil" 
                onclick="panggil('${item.no}')"
                ${item.status === "Dipanggil" ? "disabled" : ""}>
                PANGGIL
              </button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error("Ralat muat senarai:", err);
      }
    }

    async function panggil(no) {
      try {
        await fetch(API_URL + "?action=panggil&no=" + encodeURIComponent(no));
        loadSenarai();
      } catch (err) {
        console.error("Ralat panggil:", err);
      }
    }

    // auto refresh setiap 10 saat
    loadSenarai();
    setInterval(loadSenarai, 10000);
  </script>
</body>
</html>
